(function(t,e){function n(){return i?i.fn.getScrollTop():c.body.scrollTop}function o(){return i?i.offsetHeight:c.body.clientHeight}var i,c=t.document,s=t.navigator,r=s.appVersion,l=(/android/gi.test(r),/iphone|ipad/gi.test(r));e.plugin.lazyload={_options:null,_startScrollTime:0,_endScrollTime:0,_scrollFlickTime:200,_getParent:function(t){return t.offsetParent||t.parentNode},_getOffset:function(t){var n,o=e.component.getActiveContent(),s=getComputedStyle(t),r=parseFloat(t.getAttribute("height")||t.offsetHeight||s.height),l=parseFloat(t.offsetTop),h=0;if(!i)for(n=this._getParent(o);n&&n!=c.body;)h+=parseFloat(n.offsetTop),n=this._getParent(n);for(n=this._getParent(t);n&&n!=o;)l+=parseFloat(n.offsetTop||0),n=this._getParent(n);return{top:l+h,bottom:l+r+h}},_checkStart:function(){this._startScrollTime=Date.now()},_checkEnd:function(){var t=this;if(this._endScrollTime=Date.now(),this._endScrollTime-this._startScrollTime<this._scrollFlickTime)if(l)window.addEventListener("scroll",this.check);else var e=c.body.scrollTop,n=setInterval(function(){e===c.body.scrollTop?(clearInterval(n),t.check()):e=c.body.scrollTop},50);else this.check()},check:function(){for(var t=this._options,i=t.page.dataAttr||"data-src",c=e.component.getActiveContent(),s=c.querySelectorAll("img["+i+"]"),r=n(),l=n()+o(),h=0;s.length>h;h++){var a,f=s[h],d=this._getOffset(f);(d.top>r&&l>d.top||d.bottom>r&&l>d.bottom)&&(a=f.getAttribute(i),a&&(f.setAttribute("src",a),f.removeAttribute(i)))}},on:function(t,n){this._options=n,i=e.component.get("scroll"),this._checkStart=this._checkStart.bind(this),this._checkEnd=this._checkEnd.bind(this),this.check=this.check.bind(this),i?e.component.on("scrollEnd",this.check):(c.addEventListener("touchstart",this._checkStart,!1),c.addEventListener("touchend",this._checkEnd,!1))},off:function(){i?e.component.off("scrollEnd",this.check):(c.removeEventListener("touchstart",this._checkStart,!1),c.removeEventListener("touchend",this._checkEnd,!1))}}})(window,window.app);