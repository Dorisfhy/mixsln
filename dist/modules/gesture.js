define("#mix/sln/0.1.0/modules/gesture",["mix/core/0.3.0/base/reset","mix/core/0.3.0/base/class"],function(a){function h(a,b,c,d,e,f,g,h){var i=Math.atan2(h-f,g-e)-Math.atan2(d-b,c-a),j=Math.sqrt((Math.pow(h-f,2)+Math.pow(g-e,2))/(Math.pow(d-b,2)+Math.pow(c-a,2))),k=[e-j*a*Math.cos(i)+j*b*Math.sin(i),f-j*b*Math.cos(i)-j*a*Math.sin(i)];return{rotate:i,scale:j,translate:k,matrix:[[j*Math.cos(i),-j*Math.sin(i),k[0]],[j*Math.sin(i),j*Math.cos(i),k[1]],[0,0,1]]}}function i(a,b,c){var d=document.createEvent("HTMLEvents");return d.initEvent(a,!0,!0),b&&(c?Object.each(c,function(a){d[a]=b[a]}):Object.extend(d,b)),d}a("mix/core/0.3.0/base/reset");var d=window,e=d.document,f=["screenX","screenY","clientX","clientY","pageX","pageY"],g=a("mix/core/0.3.0/base/class"),j=g.create({initialize:function(a){var b=this;b._el=a,b._myGestures={},b._lastTapTime=0/0,b._onStart=b._onStart.bind(b),b._onDoing=b._onDoing.bind(b),b._onEnd=b._onEnd.bind(b),b._onTap=b._onTap.bind(b)},getElement:function(){return that._el},enable:function(){var a=this,b=a._el;b.addEventListener("touchstart",a._onStart,!1),b.addEventListener("tap",a._onTap,!1)},disable:function(){var a=this,b=a._el;b.removeEventListener("touchstart",a._onStart),b.removeEventListener("tap",a._onTap)},_onStart:function(a){var b=this,c=b._el,d=b._myGestures;if(0===Object.keys(d).length&&(e.body.addEventListener("touchmove",b._onDoing,!1),e.body.addEventListener("touchend",b._onEnd,!1)),Object.each(a.changedTouches,function(a){var b={};for(var e in a)b[e]=a[e];var f={startTouch:b,startTime:Date.now(),status:"tapping",pressingHandler:setTimeout(function(){if("tapping"===f.status){f.status="pressing";var a=i("press",b);c.dispatchEvent(a)}clearTimeout(f.pressingHandler),f.pressingHandler=null},500)};d[a.identifier]=f}),2==Object.keys(d).length){var f=i("dualtouchstart");f.touches=JSON.parse(JSON.stringify(a.touches)),c.dispatchEvent(f)}},_onDoing:function(a){var b=this,c=b._el,d=b._myGestures;if(Object.each(a.changedTouches,function(a){var e,g,h,j,b=d[a.identifier];b&&(e=a.clientX-b.startTouch.clientX,g=a.clientY-b.startTouch.clientY,h=Math.sqrt(Math.pow(e,2)+Math.pow(g,2)),"tapping"==b.status&&h>10&&(b.status="panning",j=i("panstart",a,f),c.dispatchEvent(j)),"panning"==b.status&&(j=i("pan",a,f),j.displacementX=e,j.displacementY=g,c.dispatchEvent(j)))}),2==Object.keys(d).length){var j,k,e=[],g=[];Object.each(a.touchs,function(a){var b;(b=d[a.identifier])&&(e.push([b.startTouch.clientX,b.startTouch.clientY]),g.push([a.clientX,a.clientY]))}),j=h(e[0][0],e[0][1],e[1][0],e[1][1],g[0][0],g[0][1],g[1][0],g[1][1]),k=i("dualtouch",j),k.touches=JSON.parse(JSON.stringify(a.touches)),c.dispatchEvent(k)}},_onEnd:function(a){var g,b=this,c=b._el,d=b._myGestures;2==Object.keys(d).length&&(g=i("dualtouchend"),g.touches=JSON.parse(JSON.stringify(a.touches)),c.dispatchEvent(g));for(var h=0;a.changedTouches.length>h;h++){var j=a.changedTouches[h],k=j.identifier,l=d[k];if(l){if(l.pressingHandler&&(clearTimeout(l.pressingHandler),l.pressingHandler=null),"tapping"===l.status&&(g=i("tap",j,f),c.dispatchEvent(g)),"panning"===l.status){g=i("panend",j,f),c.dispatchEvent(g);var m=Date.now()-l.startTime;300>m&&(g=i("flick",j,f),g.duration=m,g.valocityX=(j.clientX-l.startTouch.clientX)/m,g.valocityY=(j.clientY-l.startTouch.clientY)/m,g.displacementX=j.clientX-l.startTouch.clientX,g.displacementY=j.clientY-l.startTouch.clientY,c.dispatchEvent(g))}"pressing"===l.status&&(g=i("pressend",j,f),c.dispatchEvent(g)),delete d[k]}}0==Object.keys(d).length&&(e.body.removeEventListener("touchend",b._onEnd),e.body.removeEventListener("touchmove",b._onDoing))},_onTap:function(a){var b=this,c=b._el,d=b._lastTapTime;if(500>Date.now()-d){var e=document.createEvent("HTMLEvents");e.initEvent("doubletap",!0,!0),Object.each(f,function(b){e[b]=a[b]}),c.dispatchEvent(e)}b._lastTapTime=Date.now()}});return j});